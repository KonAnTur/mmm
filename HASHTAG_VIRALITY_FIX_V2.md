# üè∑Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–æ —Ö–µ—à—Ç–µ–≥–∞–º (V2)

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –≤–∏–¥–µ–æ —Å —Ö–µ—à—Ç–µ–≥–æ–≤ –ø–æ—Å—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ –ë–î, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–∞ —Å–∞–π—Ç–µ —Å –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å—é, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –ù–µ –±—ã–ª–æ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö–µ—à—Ç–µ–≥–∞
2. –ù–µ –±—ã–ª–æ —Å–≤—è–∑–∏ —Å —Ö–µ—à—Ç–µ–≥–∞–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –≤—Å–µ –≤–∏–¥–µ–æ –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ö–µ—à—Ç–µ–≥–æ–≤

## üîß –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `hashtag` –≤ —Ç–∞–±–ª–∏—Ü—É Posts

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞:**
```prisma
model Posts {
  id             String   @id
  platform       String
  searchType     String
  username       String
  hashtag        String?   // üè∑Ô∏è –•–µ—à—Ç–µ–≥ –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –Ω–∞–π–¥–µ–Ω –ø–æ—Å—Ç
  url            String?
  caption        String?
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

**SQL –º–∏–≥—Ä–∞—Ü–∏—è:**
```sql
ALTER TABLE "Posts" ADD COLUMN "hashtag" TEXT;
CREATE INDEX "Posts_hashtag_idx" ON "Posts"("hashtag");
CREATE INDEX "Posts_platform_hashtag_idx" ON "Posts"("platform", "hashtag");
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `front/server/utils/parser.ts`:**

#### –ú–µ—Ç–æ–¥ `upsertPosts` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ö–µ—à—Ç–µ–≥:
```typescript
private static async upsertPosts(
  items: InstagramPostData[], 
  searchType: string,
  hashtag?: string  // üè∑Ô∏è –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
): Promise<void>
```

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ö–µ—à—Ç–µ–≥–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ–ª–µ:
```typescript
return {
  id: post.id,
  platform: 'instagram',
  searchType: searchType,
  username: post.username || post.ownerUsername || '',
  hashtag: hashtag || null, // üè∑Ô∏è –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ö–µ—à—Ç–µ–≥ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ–ª–µ
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

#### –í—ã–∑–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ö–µ—à—Ç–µ–≥–∞:
```typescript
// –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö–µ—à—Ç–µ–≥–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
await this.upsertPosts(detailedPosts, 'hashtags', hashtag)
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω API –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Ö–µ—à—Ç–µ–≥–∞–º

**–§–∞–π–ª:** `front/server/api/[platform]/[searchType]/videos.get.ts`

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–µ—à—Ç–µ–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```typescript
const usersRelationHashtags = await prisma.usersRelationHashtag.findMany({
    where: {
        userId: String(userData.id),
        platform: platform
    }
})
```

#### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Ö–µ—à—Ç–µ–≥–∞–º:
```typescript
if (searchType === 'hashtags') {
    const userHashtags = usersRelationHashtags.map(h => h.tag)
    
    if (userHashtags.length === 0) {
        // –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —Ö–µ—à—Ç–µ–≥–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
        return JSON.parse(JSON.stringify([], bigIntReplacer))
    }

    whereCondition = {
        ...whereCondition,
        hashtag: {
            in: userHashtags  // üè∑Ô∏è –¢–æ–ª—å–∫–æ —Ö–µ—à—Ç–µ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        }
    }
}
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è hashtag –≤ –æ—Ç–≤–µ—Ç–µ:
```typescript
const hashtag = video.hashtag || null  // üè∑Ô∏è –ü—Ä—è–º–æ –∏–∑ –ø–æ–ª—è
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ Posts —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç:
```json
{
  "id": "video123",
  "platform": "instagram",
  "searchType": "hashtags",
  "username": "fashion_blogger",
  "hashtag": "–º–æ–¥–∞",  // üè∑Ô∏è –•–µ—à—Ç–µ–≥ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ–ª–µ
  "caption": "–ö—Ä—É—Ç–æ–π –æ–±—Ä–∞–∑",
  "videoPlayCount": 5000,
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

### –¢–∞–±–ª–∏—Ü–∞ UsersRelationHashtag —Å–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ö–µ—à—Ç–µ–≥–∏:
```json
{
  "userId": "user123",
  "platform": "instagram", 
  "tag": "–º–æ–¥–∞"
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –í–∏–¥–µ–æ –ø–∞—Ä—Å–∏–ª–∏—Å—å, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –≤—Å–µ –≤–∏–¥–µ–æ –ø–æ –≤—Å–µ–º —Ö–µ—à—Ç–µ–≥–∞–º
- ‚ùå –ù–µ –±—ã–ª–æ —Å–≤—è–∑–∏ —Å —Ö–µ—à—Ç–µ–≥–∞–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –í–∏–¥–µ–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ —Ö–µ—à—Ç–µ–≥–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ö–∞–∂–¥–æ–µ –≤–∏–¥–µ–æ –∑–Ω–∞–µ—Ç –ø–æ –∫–∞–∫–æ–º—É —Ö–µ—à—Ç–µ–≥—É –Ω–∞–π–¥–µ–Ω–æ
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –±–ª–∞–≥–æ–¥–∞—Ä—è –∏–Ω–¥–µ–∫—Å–∞–º
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ö–µ—à—Ç–µ–≥–∞–º–∏ ["–º–æ–¥–∞", "—Å—Ç–∏–ª—å"]:
```
GET /api/instagram/hashtags/videos
```

**–í–µ—Ä–Ω–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø–æ —Ö–µ—à—Ç–µ–≥–∞–º #–º–æ–¥–∞ –∏ #—Å—Ç–∏–ª—å**

### API –æ—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç —Ö–µ—à—Ç–µ–≥:
```json
{
  "id": "video123",
  "username": "fashion_blogger",
  "virality": "15%",
  "hashtag": "–º–æ–¥–∞",  // üè∑Ô∏è –ü–æ –∫–∞–∫–æ–º—É —Ö–µ—à—Ç–µ–≥—É –Ω–∞–π–¥–µ–Ω–æ
  "videoPlayCount": 5000,
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î:
```bash
cd front
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞: front/prisma/migrations/add_hashtag_to_posts.sql
```

### 2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma –∫–ª–∏–µ–Ω—Ç:
```bash
npx prisma generate
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
npm run dev
```

## üîÑ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Å—Ç—ã –±–µ–∑ —Ö–µ—à—Ç–µ–≥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç —Ö–µ—à—Ç–µ–≥
- ‚úÖ API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (—Å —Ö–µ—à—Ç–µ–≥–æ–º –∏ –±–µ–∑)
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º searchType

## üéâ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:** –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ö–µ—à—Ç–µ–≥–∏
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ò–Ω–¥–µ–∫—Å—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ö–µ—à—Ç–µ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —Ö–µ—à—Ç–µ–≥–∞
5. **UX:** –ü–æ–Ω—è—Ç–Ω–æ –∫–∞–∫–æ–µ –≤–∏–¥–µ–æ –æ—Ç –∫–∞–∫–æ–≥–æ —Ö–µ—à—Ç–µ–≥–∞ 